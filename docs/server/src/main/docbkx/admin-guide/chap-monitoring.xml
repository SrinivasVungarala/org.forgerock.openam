<?xml version="1.0" encoding="UTF-8"?>
<!--
  ! CCPL HEADER START
  !
  ! This work is licensed under the Creative Commons
  ! Attribution-NonCommercial-NoDerivs 3.0 Unported License.
  ! To view a copy of this license, visit
  ! http://creativecommons.org/licenses/by-nc-nd/3.0/
  ! or send a letter to Creative Commons, 444 Castro Street,
  ! Suite 900, Mountain View, California, 94041, USA.
  !
  ! You can also obtain a copy of the license at
  ! src/main/resources/legal-notices/CC-BY-NC-ND.txt.
  ! See the License for the specific language governing permissions
  ! and limitations under the License.
  !
  ! If applicable, add the following below this CCPL HEADER, with the fields
  ! enclosed by brackets "[]" replaced with your own identifying information:
  !      Portions Copyright [yyyy] [name of copyright owner]
  !
  ! CCPL HEADER END
  !
  !      Copyright 2011-2015 ForgeRock AS.
  !    
-->
<chapter xml:id='chap-monitoring'
 xmlns='http://docbook.org/ns/docbook'
 version='5.0' xml:lang='en'
 xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
 xsi:schemaLocation='http://docbook.org/ns/docbook
                     http://docbook.org/xml/5.0/xsd/docbook.xsd'
 xmlns:xlink='http://www.w3.org/1999/xlink'>
 <title>Monitoring OpenAM Services</title>

 <para>This chapter covers how to monitor OpenAM services to ensure
 appropriate performance and service availability.</para>
 
 <section xml:id="monitoring-interfaces">
  <title>Monitoring Interfaces</title>
  <indexterm><primary>Monitoring</primary></indexterm>
  
  <para>OpenAM lets you monitor OpenAM over protocol through web pages,
  Java Management Extensions (JMX), or Simple Network Management Protocol
  (SNMP). The services are based on JMX.</para>
  
  <para>To configure monitoring services, login to OpenAM console as OpenAM
  administrator, and browse to Configuration &gt; System &gt; Monitoring.
  Alternatively, you can use the <command>ssoadm set-attr-defs</command>
  command:</para>

  <screen>
$ <userinput>ssoadm \
 set-attr-defs \
 --servicename iPlanetAMMonitoringService \
 --schematype Global \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --attributevalues iplanet-am-monitoring-enabled=true</userinput>
  </screen>

  <para>Restart OpenAM for the changes to take effect. You must also restart
  OpenAM if you disable monitoring.</para>

  <section xml:id="monitoring-web-pages">
   <title>Web-Based Monitoring</title>
   
   <para>You can configure OpenAM to allow you to access a web based view of
   OpenAM MBeans on port 8082 where the core server runs, such as
   <literal>http://openam-ter.example.com:8082/</literal>. Either use the
   console, or use the <command>ssoadm</command> command:</para>

   <screen>
$ <userinput>ssoadm \
 set-attr-defs \
 --servicename iPlanetAMMonitoringService \
 --schematype Global \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --attributevalues iplanet-am-monitoring-http-enabled=true</userinput>
   </screen>

   <para>The default authentication file allows you to authenticate over HTTP
   as user <literal>demo</literal>, password <literal>changeit</literal>. The
   user name and password are kept in the file specified, with the password
   encrypted:</para>
   
   <screen>
$ <userinput>cat openam/openam/openam_mon_auth</userinput>
<computeroutput>demo AQICMBCKlwx6G3vzK3TYYRbtTpNYAagVIPNP</computeroutput>
   </screen>

   <para>Or:</para>
   
   <screen>
$ <userinput>cat openam/openam/opensso_mon_auth</userinput>
<computeroutput>demo AQICvSe+tXEg8TUUT8ekzHb8IRzVSvm1Lc2u</computeroutput>
   </screen>
   
   <para>You can encrypt a new password using the <command>ampassword</command>
   command. After changing the authentication file, you must restart OpenAM
   for the changes to take effect.</para>

   <figure xml:id="figure-web-based-monitoring">
    <title>OpenAM MBeans in a Browser</title>
    <mediaobject>
     <alt>OpenAM MBeans in a browser</alt>
     <imageobject>
      <imagedata fileref="images/web-based-monitoring.png" format="PNG" />
     </imageobject>
     <textobject><para>You can monitor OpenAM through a web browser.</para></textobject>
    </mediaobject>
   </figure>

  </section>
  
  <section xml:id="monitoring-jmx">
   <title>JMX Monitoring</title>
   <indexterm>
    <primary>Monitoring</primary>
    <secondary>JMX</secondary>
   </indexterm>
   <para>You can configure OpenAM to allow you to listen for Java Management
   eXtension (JMX) clients, by default on port 9999. Either use the OpenAM
   console page under Configuration &gt; System &gt; Monitoring and make sure
   both Monitoring Status and Monitoring RMI interface status are both set to
   Enabled, or use the <command>ssoadm</command> command:</para>

   <screen>
$ <userinput>ssoadm \
 set-attr-defs \
 --servicename iPlanetAMMonitoringService \
 --schematype Global \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --attributevalues iplanet-am-monitoring-enabled=true \
  iplanet-am-monitoring-rmi-enabled=true</userinput>
   </screen>

   <para>A number of tools support JMX, including <command>jvisualvm</command>
   and <command>jconsole</command>. When you use <command>jconsole</command>
   to browse OpenAM MBeans for example, the default URL for the OpenAM running
   on the local system is
   <literal>service:jmx:rmi:///jndi/rmi://localhost:9999/server</literal>.</para>

   <screen>
$ <userinput>jconsole service:jmx:rmi:///jndi/rmi://localhost:9999/server &amp;</userinput>
   </screen>

   <para>You can also browse the MBeans by connecting to your web application
   container, and browsing to the OpenAM MBeans. By default, JMX monitoring for
   your container is likely to be accessible only locally, using the process
   ID.</para>

   <figure xml:id="figure-jconsole-to-openam">
    <title>JConsole Browsing OpenAM MBeans</title>
    <mediaobject>
     <alt>JConsole browsing OpenAM MBeans</alt>
     <imageobject>
      <imagedata fileref="images/jconsole-to-openam.png" format="PNG" />
     </imageobject>
     <textobject><para>You can monitor OpenAM over JMX.</para></textobject>
    </mediaobject>
   </figure>

   <para>Also see <link xlink:show="new"
   xlink:href="http://docs.oracle.com/javase/1.5.0/docs/guide/management/agent.html"
   >Monitoring and Management Using JMX</link> for instructions on how to
   connect remotely, how to use SSL, and so forth.</para>

   <important>
    <para>JMX has a limitation in that
   some Operations and CTS tables cannot be properly serialized from OpenAM to JMX.
   As a result, only a portion of OpenAM's monitoring information is available through JMX.
   SNMP is a preferred monitoring option over JMX and exposes all OpenAM tables,
   especially for CTS, with no serialization limitations.</para>
   </important>
  </section>
  
  <section xml:id="monitoring-snmp">
   <title>SNMP Monitoring</title>
   <indexterm>
    <primary>Monitoring</primary>
    <secondary>SNMP</secondary>
   </indexterm>
   
   <para>You can configure OpenAM to allow you to listen on port 8085 for SNMP
   monitoring. Either use the console, or use the <command>ssoadm</command>
   command:</para>

   <screen>
$ <userinput>ssoadm \
 set-attr-defs \
 --servicename iPlanetAMMonitoringService \
 --schematype Global \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --attributevalues iplanet-am-monitoring-snmp-enabled=true</userinput>
   </screen>
  </section>
 </section>

 <section xml:id="cts-monitoring">
  <title>Monitoring CTS Tokens</title>
   <indexterm>
    <primary>Monitoring</primary>
    <secondary>CTS</secondary>
   </indexterm>

  <para>
   The <link xlink:href="install-guide#chap-cts"
   xlink:role="http://docbook.org/xlink/role/olink">OpenAM Core
   Token Service</link> (CTS) provides persistent and highly available
   token storage for a several components within OpenAM, including
   user sessions, OAuth 2.0, SAML v2.0 and UMA tokens.
  </para>

  <para>
   Depending on system load and usage, the CTS can produce a
   large quantity of tokens, which can be short lived. This style of
   usage is significantly different from typical LDAP usage. As such,
   systems administrators may be interested in monitoring this usage
   as part of LDAP directory maintenance.
  </para>

  <para>
   The CTS functions only with one external LDAP service, OpenDJ.
  </para>

  <para>
   To that end, the current state of CTS tokens on a system
   can be monitored over SNMP. The current state of different types
   of CTS tokens are associated with different Object Identifiers (OIDs)
   in a Management Information Base (MIB).
  </para>

  <para>
   To enable SNMP, see <link xlink:href="admin-guide#monitoring-snmp"
   xlink:show="new" xlink:role="http://docbook.org/xlink/role/olink">
   <citetitle>SNMP Monitoring</citetitle>.</link>
  </para>

  <section xml:id="cts-monitor-commands">
   <title>CTS SNMP Monitoring</title>

   <para>
    Once activated, SNMP monitoring works over UDP by default. You may
    want to install one of many available network monitoring tools. For
    the purpose of this section, basic SNMP service and monitoring tools
    have been installed on a GNU/Linux system. The same commands should
    work on a Mac OS X system.
   </para>

   <para>SNMP depends on labels known as Object Identifiers (OIDs). These
    are uniquely defined labels, organized in tree format. For OpenAM, they
    are configured in a Management Information Base file named
    <link xlink:show="new"
    xlink:href="https://svn.forgerock.org/openam/trunk/openam/openam-schema/openam-mib-schema/src/main/resources/mib/FORGEROCK-OPENAM-CTS.mib">
    <filename>FORGEROCK-OPENAM-CTS.mib</filename></link>.
   </para>

   <!-- Discussion in progress about including the mib file in the binary -->

   <para>
    For detailed information on configured OIDs, see the OpenAM Reference
    chapter on the <link xlink:show="new" xlink:href="reference#chap-cts-oids"
    xlink:role="http://docbook.org/xlink/role/olink">
    <citetitle>Core Token Service (CTS) Object Identifiers (OIDs)</citetitle>.
    </link>
   </para>

   <para>
    With the OIDs in hand, you can set up an SNMP server to collect
    the data. You would also need SNMP utility commands with associated
    OIDs to measure the current state of a component. First, to verify
    the operation of SNMP on a GNU/Linux system, over port 8085,
    using SNMP version 2c, run the following command:</para>

   <screen>
# <userinput>snmpstatus -c public -v 2c localhost</userinput>
   </screen>

   <para>The output should normally specify communications over UDP. If you
   get a <literal>timeout</literal> message, the SNMP service may not be
   running.</para>

   <para>You can get the value for a specific OID. For example, the
    following command would retrieve the cumulative count for CTS
    create operations, over port 8085:</para>

   <screen>
# <userinput>snmpget -c public -v 2c :8085 enterprises.36733.1.2.3.3.1.1.1</userinput>
   </screen>

   <para>
    For one view of the tree of OIDs, you can use the
    <command>snmpwalk</command> command. For example, the following command
    lists all OIDs related to CTS:
   </para>

   <screen>
# <userinput>snmpwalk -c public -v 2c :8085 enterprises.36733.1.2.3</userinput>
   </screen>

   <para>
    A number of CTS OIDs are listed with a <literal>Counter64</literal> value.
    As defined in <link xlink:show="new"
    xlink:href="http://tools.ietf.org/search/rfc2578#section-7.1.10">
    <citetitle>RFC 2578</citetitle>,</link> an OID so configured has a maximum
    value of <literal>2^64 - 1</literal>.
   </para>

  </section>

  <section xml:id="snmp-policy-evaluation">
   <title>SNMP Monitoring for Policy Evaluation</title>

   <indexterm>
    <primary>Monitoring</primary>
    <secondary>Policy evaluation</secondary>
   </indexterm>

   <para>
    You can monitor policy evaluation performance over SNMP.
    OpenAM records statistics for up to
    a number of recent policy evaluation requests.
    (You can configure the number in OpenAM console
    under Configuration > System > Monitoring.
    For details, see the system configuration reference section,
    <link
     xlink:href="reference#system-monitoring"
     xlink:role="http://docbook.org/xlink/role/olink"
     xlink:show="new"
     ><citetitle>Monitoring</citetitle></link>.)
   </para>

   <para>
    Interface Stability:
    <link
     xlink:show="new"
     xlink:href="admin-guide#interface-stability"
     xlink:role="http://docbook.org/xlink/role/olink">Evolving</link>
   </para>

   <para>
    As described in <xref linkend="cts-monitor-commands" />,
    SNMP uses OIDs defined in a Management Information Base (MIB) file
    that specifies the statistics OpenAM keeps for policy evaluation operations,
    <link
     xlink:show="new"
     xlink:href="https://svn.forgerock.org/openam/trunk/openam/openam-schema/openam-mib-schema/src/main/resources/mib/FORGEROCK-OPENAM-POLICY.mib"
    ><filename>FORGEROCK-OPENAM-POLICY.mib</filename></link>.
    Adapt the examples in <xref linkend="cts-monitor-commands" />
    to read monitoring statistics about policy evaluation on the command line.
   </para>

   <para>
    When monitoring is active, OpenAM records statistics about
    both the numbers and rates of policy evaluations performed,
    and also the times taken to process policy evaluations.
   </para>

   <para>
    The statistics are all read-only.
    The base OID for policy evaluation statistics is
    <literal>enterprises.36733.1.2.2.1</literal>.
    The following table describes the values that you can read:
   </para>

   <table xml:id="snmp-policy-evaluation-oids">
    <title>OIDs Used in SNMP Monitoring For Policy Evaluation</title>

    <tgroup cols="3">
     <colspec colnum="1" colwidth="2*"/>
     <colspec colnum="2" colwidth="2*"/>
     <colspec colnum="3" colwidth="1*"/>

     <thead>
      <row>
       <entry>OID</entry>
       <entry>Description</entry>
       <entry>Syntax</entry>
      </row>
     </thead>

     <tbody>
      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.1.1</literal>
        </para>
       </entry>
       <entry>
        <para>
         Cumulative number of policy evaluations for specific resources (self)
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.1.2</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average rate of policy evaluations for specific resources (self)
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.1.3</literal>
        </para>
       </entry>
       <entry>
        <para>
         Minimum rate of policy evaluations for specific resources (self)
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.1.4</literal>
        </para>
       </entry>
       <entry>
        <para>
         Maximum rate of policy evaluations for specific resources (self)
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.2.1</literal>
        </para>
       </entry>
       <entry>
        <para>
         Cumulative number of policy evaluations for a tree of resources (subtree)
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.2.2</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average rate of policy evaluations for a tree of resources (subtree)
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.2.3</literal>
        </para>
       </entry>
       <entry>
        <para>
         Minimum rate of policy evaluations for a tree of resources (subtree)
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.2.4</literal>
        </para>
       </entry>
       <entry>
        <para>
         Maximum rate of policy evaluations for a tree of resources (subtree)
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.2.1.1</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average length of time to evaluate a policy for a specific resource (self)
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.2.1.2</literal>
        </para>
       </entry>
       <entry>
        <para>
         Slowest evaluation time for a specific resource (self)
        </para>
       </entry>
       <entry>
        <para>
         <literal>SnmpAdminString</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.2.2.1</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average length of time to evaluate a policy for a tree of resources (subtree)
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.2.2.2</literal>
        </para>
       </entry>
       <entry>
        <para>
         Slowest evaluation time for a tree of resources (subtree)
        </para>
       </entry>
       <entry>
        <para>
         <literal>SnmpAdminString</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.2.1.3.1</literal>
        </para>
       </entry>
       <entry>
        <para>
         Slowest individual policy evaluation time overall
        </para>
       </entry>
       <entry>
        <para>
         <literal>SnmpAdminString</literal>
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </section>

  <section xml:id="snmp-sessions">
   <title>SNMP Monitoring for Sessions</title>

   <indexterm>
    <primary>Monitoring</primary>
    <secondary>Sessions</secondary>
   </indexterm>

   <para>
    You can monitor stateful session statistics over SNMP.
    OpenAM records statistics for up to
    a configurable number of recent sessions.
    (You can configure the number in OpenAM console
    under Configuration > System > Monitoring.
    For details, see the system configuration reference section,
    <link
     xlink:href="reference#system-monitoring"
     xlink:role="http://docbook.org/xlink/role/olink"
     xlink:show="new"
     ><citetitle>Monitoring</citetitle></link>.)
   </para>

   <para>
    SNMP monitoring is not available for stateless sessions.
   </para>

   <para>
    Interface Stability:
    <link
     xlink:show="new"
     xlink:href="admin-guide#interface-stability"
     xlink:role="http://docbook.org/xlink/role/olink">Evolving</link>
   </para>

   <para>
    As described in <xref linkend="cts-monitor-commands" />,
    SNMP uses OIDs defined in a Management Information Base (MIB) file
    that specifies the statistics OpenAM keeps for policy evaluation operations,
    <link
     xlink:show="new"
     xlink:href="https://svn.forgerock.org/openam/trunk/openam/openam-schema/openam-mib-schema/src/main/resources/mib/FORGEROCK-OPENAM-SESSION.mib"
     ><filename>FORGEROCK-OPENAM-SESSION.mib</filename></link>.
    Adapt the examples in <xref linkend="cts-monitor-commands" />
    to read monitoring statistics about sessions on the command line.
   </para>

   <para>
    When monitoring is active, OpenAM records statistics about
    both the numbers of internal, remote, and CTS sessions,
    and also the times taken to process sessions.
   </para>

   <para>
    The statistics are all read-only.
    The base OID for session statistics is
    <literal>enterprises.36733.1.2.1</literal>.
    Times are expressed in nanoseconds rather than milliseconds,
    as many operations take less than one millisecond.
    The following table describes the values that you can read:
   </para>

   <table xml:id="snmp-sessions-oids">
    <title>OIDs Used in SNMP Monitoring For Sessions</title>

    <tgroup cols="3">
     <colspec colnum="1" colwidth="2*"/>
     <colspec colnum="2" colwidth="2*"/>
     <colspec colnum="3" colwidth="1*"/>

     <thead>
      <row>
       <entry>OID</entry>
       <entry>Description</entry>
       <entry>Syntax</entry>
      </row>
     </thead>

     <tbody>
      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.1.1</literal>
        </para>
       </entry>
       <entry>
        <para>
         Total number of current internal sessions
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.1.2</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to refresh an internal session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.1.3</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to logout an internal session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.1.4</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to destroy an internal session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.1.5</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to set a property on an internal session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.2.1</literal>
        </para>
       </entry>
       <entry>
        <para>
         Total number of current remote sessions
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.2.2</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to refresh a remote session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.2.3</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to logout a remote session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.2.4</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to destroy a remote session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.2.5</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to set a property on a remote session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.3.1</literal>
        </para>
       </entry>
       <entry>
        <para>
         Total number of sessions currently in the Core Token Service (CTS)
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.3.2</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to refresh a CTS session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.3.3</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to logout a CTS session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.3.4</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to destroy a CTS session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>

      <row>
       <entry>
        <para>
         <literal>enterprises.36733.1.2.1.3.5</literal>
        </para>
       </entry>
       <entry>
        <para>
         Average time it takes to set a property on a CTS session
        </para>
       </entry>
       <entry>
        <para>
         <literal>Counter64</literal>
        </para>
       </entry>
      </row>
     </tbody>
    </tgroup>
   </table>
  </section>
 </section>
 
 <section xml:id="is-openam-alive">
  <title>Is OpenAM Running?</title>
   <indexterm>
    <primary>Monitoring</primary>
    <secondary>Health check</secondary>
   </indexterm>
  
  <para>You can check over HTTP whether OpenAM is up, using
  <filename>isAlive.jsp</filename>. Point your application to the file
  under the OpenAM URL, such as
  <literal>http://openam.example.com:8080/openam/isAlive.jsp</literal>.</para>
  
  <para>If you get a success code (with <literal>Server is ALIVE:</literal> in
  the body of the page returned), then OpenAM is in operation.</para>
 </section>
 
 <section xml:id="debug-logging">
  <title>Debug Logging</title>
  <indexterm>
   <primary>Logging</primary>
   <secondary>Debug</secondary>
  </indexterm>
  
  <para>
   OpenAM services capture a variety of information in debug logs.
   Unlike audit log records, debug log records are unstructured.
   Debug logs contain a variety of types of information that is useful
   when troubleshooting OpenAM, including stack traces.
   The level of debug log record output is configurable.
   Debug log records are always written to flat files.
  </para>

  <section xml:id="log-debug-levels">
   <title>Setting Debug Logging Levels</title>
   <indexterm>
    <primary>Debug logging</primary>
    <secondary>Level</secondary>
   </indexterm>
   <para>
    To adjust the debug level while OpenAM is running, login to the OpenAM
    console as OpenAM administrator, and browse to Configuration &gt; Servers
    and Sites &gt; <replaceable>Server Name</replaceable> &gt; General, and then
    scroll down to Debugging. The default level for debug logging is Error.
    This level is appropriate for normal production operations, in which case
    no debug log messages are expected.
   </para>
   <para>
    Setting the debug log level to Warning increases the volume of messages.
    Setting the debug log level to Message dumps detailed trace messages. Unless
    told to do so by qualified support personnel, do not use Warning and Message
    levels in production.
   </para>
  </section>

  <section xml:id="log-debug-single-file">
   <title>Debug Logging to a Single File</title>
   <indexterm>
    <primary>Debug logging</primary>
    <secondary>Single file</secondary>
   </indexterm>
   <para>
    During development, you might find it useful to log all debug messages
    to a single file. In order to do so, set Merge Debug Files to
    <literal>on</literal>.
   </para>

   <para>
    OpenAM logs to a single file immediately after you change this property.
    You do not need to restart OpenAM or the container in which it runs for
    the change to take effect.
   </para>
  </section>
  
  <section xml:id="log-debug-selective-capture">
   <title>Debug Logging By Service</title>
   <indexterm>
    <primary>Debug logging</primary>
    <secondary>Service selection</secondary>
   </indexterm>

   <para>OpenAM lets you capture debug log messages selectively for a specific
   service. This can be useful when you must turn on debugging in a production
   system where you want to avoid excessive logging, but must gather messages
   when you reproduce a problem.</para>

   <orderedlist>
    <para>Perform these steps to capture debug messages for a specific
    service:</para>
    <listitem>
     <para>Log in to OpenAM console as administrator,
     <literal>amadmin</literal>.</para>
    </listitem>
    <listitem>
     <para>Browse to <filename>Debug.jsp</filename>, for example
     <literal>http://openam.example.com:8080/openam/Debug.jsp</literal>.</para>
     <para>No links to this page are provided in the console.</para>
    </listitem>
    <listitem>
     <para>Select the service to debug and also the level required given the
     hints provided in the <filename>Debug.jsp</filename> page.</para>
     <para>The changes takes effect immediately.</para>
    </listitem>
    <listitem>
     <para>Promptly reproduce the problem you are investigating.</para>
    </listitem>
    <listitem>
     <para>After reproducing the problem, immediately return to the
     <filename>Debug.jsp</filename> page, and revert to normal log levels
     to avoid filling up the disk where debug logs are stored.</para>
    </listitem>
   </orderedlist>
  </section>

  <section xml:id="log-rotate-debug">
   <title>Rotating Debug Logs</title>
   <indexterm>
    <primary>Debug logging</primary>
    <secondary>Rotation</secondary>
   </indexterm>

   <para>By default OpenAM does not rotate debug logs. To rotate debug logs,
   edit <filename>WEB-INF/classes/debugconfig.properties</filename> where
   OpenAM is deployed.</para>

   <variablelist>
    <para>The <filename>debugconfig.properties</filename> file includes
    the following properties:</para>

    <varlistentry>
     <term><literal>org.forgerock.openam.debug.prefix</literal></term>
     <listitem>
      <para>This property specifies the debug log file prefix applied when
      OpenAM rotates a debug log file. The property has no default. It takes
      a string as the property value.</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>org.forgerock.openam.debug.suffix</literal></term>
     <listitem>
      <para>This property specifies the debug log file suffix applied when
      OpenAM rotates a debug log file. The property takes a
      <literal>SimpleDateFormat</literal> string. The default is
      <literal>-MM.dd.yyyy-kk.mm</literal>.</para>
     </listitem>
    </varlistentry>
    <varlistentry>
     <term><literal>org.forgerock.openam.debug.rotation</literal></term>
     <listitem>
      <para>This property specifies an interval in minutes between debug
      log rotations. Set this to a value greater than zero to enable debug
      log rotation.</para>
     </listitem>
    </varlistentry>
   </variablelist>

   <para>
    Changes to properties in the
    <filename>debugconfig.properties</filename> file
    take effect immediately.
    You do not need to restart OpenAM or the container in which it runs for
    the changes to take effect.
   </para>
  </section>
 </section>

 <section xml:id="recording">
  <title>Recording Troubleshooting Information</title>

  <para>
   The OpenAM recording facility lets you initiate events to monitor
   OpenAM while saving output that is useful when performing troubleshooting.
  </para>
  <para>
   OpenAM recording events save four types of information:
   <itemizedlist>
    <listitem>
     <para>
      OpenAM debug logs
     </para>
    </listitem>
    <listitem>
     <para>
      Thread dumps, which show you the status of every active thread, with
      output similar to a JStack stack trace
     </para>
    </listitem>
    <listitem>
     <para>
      Important run-time properties
     </para>
    </listitem>
    <listitem>
     <para>
      The OpenAM configuration
     </para>
    </listitem>
   </itemizedlist>
  </para>

  <para>
   You initiate a recording event by invoking the
   <command>ssoadm start-recording</command> command or by using the
   <literal>start</literal> action of the <literal>/json/records</literal>
   REST API endpoint. Both methods use JSON to control the recording event.
  </para>

  <para>
   This section describes starting and stopping recording using the
   <command>ssoadm</command> command, using a JSON file to configure the
   recording event, and locating the output recorded information.
   For information about using the <literal>/json/records</literal> REST API
   endpoint to activate and deactivate recording, see
   <olink targetdoc="dev-guide" targetptr="sec-rest-api-recording" />.
  </para>

  <section xml:id="recording-start-stop">
   <title>Starting and Stopping Recording</title>

   <para>
    Start OpenAM recording with the <command>ssoadm start-recording</command>
    command. For example:
   </para>
<screen>$ <userinput>ssoadm \
 start-recording \
 --servername http://openam.example.com:8080/openam \
 --adminid amadmin \
 --password-file /tmp/pwd.txt \
 --jsonfile <replaceable>recording.json</replaceable></userinput>

<computeroutput>
{
 "recording":true,
 "record": {
  "issueID":103572,
  "referenceID":"policyEvalFails",
  "description":"Record everything",
  "zipEnable":false,
  "threadDump": {
   "enable":true,
   "delay": {
     "timeUnit":"SECONDS",
     "value":5
   }
  },
  "configExport": {
   "enable":true,
   "password":"<replaceable>admin password</replaceable>",
   "sharePassword":true
  },
  "debugLogs": {
   "debugLevel":"message",
   "autoStop": {
    "time": {
     "timeUnit":"MILLISECONDS",
     "value":15000
    },
    "fileSize": {
     "sizeUnit":"KB",
     "value":1048576
    }
   }
  },
  "status":"RUNNING",
  "folder":"/home/openam/debug/record/103572/policyEvalFails/"
 }
}
</computeroutput>
</screen>

   <note>
    <para>
     The <command>ssoadm</command> command output in the preceding example is
     shown in indented format for ease of reading. The actual output is
     <emphasis>not</emphasis> indented.
    </para>
   </note>

   <para>
    In the preceding <command>ssoadm start-recording</command> command example,
    the <filename>recording.json</filename> file specifies the information
    to be recorded and under what conditions recording automatically terminates.
    This file is known as the <firstterm>recording control file</firstterm>.
    <xref linkend="recording-json" /> describes the format of recording control
    files and provides an annotated example.
   </para>

   <para>
    An active recording event stops when:
    <itemizedlist>
     <listitem>
      <para>
       You explicitly tell OpenAM to stop recording by executing the
       <command>ssoadm stop-recording</command> command. See
       the <olink targetdoc="reference"/> for details about this
       command.
      </para>
     </listitem>
     <listitem>
      <para>
       Another <command>ssoadm start-recording</command> command is sent to
       OpenAM that specifies an issue ID other that differs from the active
       recording event's issue ID. In this case, the initial recording session
       terminates and the new recording event starts. Note that you can
       determine whether an OpenAM recording event is active by using the
       <command>ssoadm get-recording-status</command> command.
      </para>
     </listitem>
     <listitem>
      <para>
       A timer configured in the recording control file determines that the
       maximum amount of time for the recording event has been reached.
      </para>
     </listitem>
     <listitem>
      <para>
       A file size monitor configured in the recording control file determines
       that the maximum amount of information in debug logs has been reached.
      </para>
     </listitem>
    </itemizedlist>
   </para>

  </section>

  <section xml:id="recording-json">
   <title>The Recording Control File</title>

   <para>
    A JSON file that is input to the <command>ssoadm start-recording</command> command
    controls the amount of information OpenAM records, the recording duration,
    and the location of recording output files.
   </para>

   <section xml:id="recording-file-format">
    <title>File Format</title>

    <variablelist>
     <para>
      The following properties comprise the recording control file:
     </para>

     <varlistentry>
      <term><literal>issueID</literal></term>
      <listitem>
       <para>
        Type: Number
       </para>
       <para>
        <emphasis>Required</emphasis>.
        The issue identifier&#x2014;a positive integer stored internally as a
        Java <literal>long</literal> data type. A case number is a good choice
        for the <literal>issueID</literal> value.
       </para>
       <para>
        The <literal>issueID</literal>
        is a component of the path at which recorded information is stored. See
        <xref linkend="recording-location" />
        for more information.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><literal>referenceID</literal></term>
      <listitem>
       <para>
        Type: String
       </para>
       <para>
        <emphasis>Required</emphasis>.
        A second identifier for the recording event. Use this property to
        segregate multiple recording events for the same issue.
       </para>
       <para>
        The <literal>referenceID</literal>
        is a component of the path at which recorded information is stored. See
        <xref linkend="recording-location" />
        for more information.
       </para>
       <para>
        Note that spaces are not allowed in the <literal>referenceID</literal>
        value.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><literal>Description</literal></term>
      <listitem>
       <para>
        Type: String
       </para>
       <para>
        <emphasis>Required</emphasis>.
        A textual description of the recording event.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><literal>zipEnable</literal></term>
      <listitem>
       <para>
        Type: Boolean
       </para>
       <para>
        <emphasis>Required</emphasis>.
        Whether to compress the output directory into a zip file when recording
        has stopped.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><literal>configExport</literal></term>
      <listitem>
       <para>
        Type: Object
       </para>
       <para>
        <emphasis>Required</emphasis>.
        An object containing the following properties:

        <variablelist>

         <varlistentry>
          <term><literal>enable</literal></term>
          <listitem>
           <para>
            Type: Boolean
           </para>
           <para>
            <emphasis>Required</emphasis>.
            Whether to export the OpenAM configuration upon completion of the
            recording event. Exporting the OpenAM configuration is a best
            practice, because it is extremely useful to have access to the
            configuration when troubleshooting.
           </para>
          </listitem>
         </varlistentry>

         <varlistentry>
          <term><literal>password</literal></term>
          <listitem>
           <para>
            Type: String
           </para>
           <para>
            <emphasis>Required</emphasis> if <literal>enable</literal>
            is <literal>true</literal>.
            A key required to import the exported configuration. The key
            is used the same way that the <command>ssoadm export-svc-cfg</command>
            command uses the <literal>-e</literal> argument.
           </para>
          </listitem>
         </varlistentry>

         <varlistentry>
          <term><literal>sharePassword</literal></term>
          <listitem>
           <para>
            Type: Boolean
           </para>
           <para>
            <emphasis>Required</emphasis> if <literal>enable</literal>
            is <literal>true</literal>.
            Whether to show the <literal>password</literal> value in the
            <command>ssoadm start-recording</command>,
            <command>ssoadm get-recording-status</command>, and
            <command>ssoadm stop-recording</command> output, and in the
            <filename>info.json</filename> file, which is output during
            recording events, and which contains run-time properties.
           </para>
          </listitem>
         </varlistentry>

        </variablelist>
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><literal>debugLogs</literal></term>
      <listitem>
       <para>
        Type: Object
       </para>
       <para>
        <emphasis>Required</emphasis>.
        An object containing the following properties:

        <variablelist>

         <varlistentry>
          <term><literal>debugLevel</literal></term>
          <listitem>
           <para>
            Type: String
           </para>
           <para>
            <emphasis>Required</emphasis>.
            The debug level to set for the recording event. Set the value
            of <literal>debugLevel</literal> to <literal>MESSAGE</literal>
            to get the most troubleshooting information from your recording
            period. Other acceptable but less commonly used values are
            <literal>ERROR</literal> and <literal>WARNING</literal>.
           </para>
          </listitem>
         </varlistentry>

         <varlistentry>
          <term><literal>autoStop</literal></term>
          <listitem>
           <para>
            Type: Object
           </para>
           <para>
            <emphasis>Optional</emphasis>.
            Contains another object used to specify an event that automatically
            ends a recording period. For time-based termination, specify a
            <literal>time</literal> object; for termination based on
            uncompressed file size, specify a <literal>fileSize</literal>
            object. If you specify both <literal>time</literal> and
            <literal>fileSize</literal> objects, the event that occurs first
            causes recording to stop.
           </para>
           <para>
            Specifying <literal>fileSize</literal> and <literal>time</literal>
            objects is a best practice, because it ensures that the recorded
            output does not occupy a larger than expected amount of space on
            your file system, and that recording events end in a timely fashion.
            <variablelist>

             <varlistentry>
              <term><literal>time</literal></term>
              <listitem>
               <para>
                Type: Object
               </para>
               <para>
                <emphasis>Optional</emphasis>; must be specified in the
                <literal>autoStop</literal> object if
                <literal>fileSize</literal> is not specified.
                Configures a recording period to terminate recording after
                this amount of time.
                <variablelist>

                 <varlistentry>
                  <term><literal>timeUnit</literal></term>
                  <listitem>
                   <para>
                    Type: String
                   </para>
                   <para>
                    <emphasis>Required</emphasis>.
                    Acceptable values are
                    <literal>MILLISECONDS</literal>,
                    <literal>SECONDS</literal>, <literal>MINUTES</literal>,
                    <literal>HOURS</literal>, and <literal>DAYS</literal>.
                   </para>
                  </listitem>
                 </varlistentry>

                 <varlistentry>
                  <term><literal>value</literal></term>
                  <listitem>
                   <para>
                    Type: Numeric
                   </para>
                   <para>
                    <emphasis>Required</emphasis>.
                    Values in <literal>MILLISECONDS</literal> are rounded down
                    to the second. The minimum acceptable value for
                    <literal>autoStop</literal> is one second.
                   </para>
                  </listitem>
                 </varlistentry>

                </variablelist>

               </para>
              </listitem>
             </varlistentry>

             <varlistentry>
              <term><literal>fileSize</literal></term>
              <listitem>
               <para>
                Type: Object
               </para>
               <para>
                <emphasis>Optional</emphasis>; must be specified in the
                <literal>autoStop</literal> object if
                <literal>time</literal> is not specified.
                Configures a recording period to terminate after the aggregate
                size of uncompressed debug logs has reached this size.
                <variablelist>

                 <varlistentry>
                  <term><literal>sizeUnit</literal></term>
                  <listitem>
                   <para>
                    Type: String
                   </para>
                   <para>
                    <emphasis>Required</emphasis>.
                    Acceptable values are <literal>B</literal>,
                    <literal>KB</literal>, <literal>MB</literal>, and
                    <literal>GB</literal>.
                   </para>
                  </listitem>
                 </varlistentry>

                 <varlistentry>
                  <term><literal>value</literal></term>
                  <listitem>
                   <para>
                    Type: Numeric
                   </para>
                   <para>
                    <emphasis>Required</emphasis>.
                   </para>
                  </listitem>
                 </varlistentry>

                </variablelist>


               </para>
              </listitem>
             </varlistentry>

            </variablelist>

           </para>
          </listitem>
         </varlistentry>

        </variablelist>
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><literal>threadDump</literal></term>
      <listitem>
       <para>
        Type: Object
       </para>
       <para>
        <emphasis>Required</emphasis>.
        An object containing the following properties:

        <variablelist>

         <varlistentry>
          <term><literal>enable</literal></term>
          <listitem>
           <para>
            Type: Boolean
           </para>
           <para>
            <emphasis>Required</emphasis>.
            Whether to dump threads during the recording event. Thread
            dumps are especially useful when troubleshooting performance
            issues and issues with unresponsive servers.
           </para>
          </listitem>
         </varlistentry>

         <varlistentry>
          <term><literal>delay</literal></term>
          <listitem>
           <para>
            Type: Object
           </para>
           <para>
            <emphasis>Required</emphasis> if <literal>enable</literal>
            is <literal>true</literal>.
            Contains another object used to specify an interval at which
            thread dumps are taken. The initial thread dump is taken at the
            start of the recording event; subsequent thread dumps are taken
            at multiples of the <literal>delay</literal> interval.
            <variablelist>

             <varlistentry>
              <term><literal>timeUnit</literal></term>
              <listitem>
               <para>
                Type: String
               </para>
               <para>
                <emphasis>Required</emphasis>.
                 Acceptable values are
                 <literal>MILLISECONDS</literal>,
                 <literal>SECONDS</literal>, <literal>MINUTES</literal>,
                 <literal>HOURS</literal>, and <literal>DAYS</literal>.
               </para>
              </listitem>
             </varlistentry>

             <varlistentry>
              <term><literal>value</literal></term>
              <listitem>
               <para>
                Type: Numeric
               </para>
               <para>
                <emphasis>Required</emphasis>.
                The minimum acceptable value is one second. Time units that are
                smaller than seconds, such as <literal>MILLISECONDS</literal>,
                are rounded to the closest second.
               </para>
              </listitem>
             </varlistentry>

            </variablelist>

           </para>
          </listitem>
         </varlistentry>

        </variablelist>
       </para>
      </listitem>
     </varlistentry>

    </variablelist>

   </section>

   <section xml:id="recording-file-examples">
    <title>Recording Control File Example</title>

    <para>
     The following is an example of a recording control file:
    </para>
    <para>
     <programlisting language="javascript">
{
  "issueID": 103572,
  "referenceID": "policyEvalFails",
  "description": "Troubleshooting artifacts in support of case 103572",
  "zipEnable": true,
  "configExport": {
    "enable": true,
    "password": "5x2RR70",
    "sharePassword": false
  },
  "debugLogs": {
    "debugLevel": "MESSAGE",
    "autoStop": {
      "time":  {
        "timeUnit": "SECONDS",
        "value": 15
      },
      "fileSize": {
        "sizeUnit": "GB",
        "value": 1
      }
    }
  },
  "threadDump" : {
    "enable": true,
    "delay" :  {
      "timeUnit": "SECONDS",
      "value": 5
     }
  }
}    </programlisting>
    </para>
    <para>
     The recording control file properties in the preceding example affect
     the recording output as follows:
     <table xml:id="recording-example-behavior">
      <title>Recording Control File Example Properties and Their Effect
       on Recording Behavior</title>
      <tgroup cols="3">
       <colspec colnum="1" colwidth="1*"/>
       <colspec colnum="2" colwidth="1*"/>
       <colspec colnum="3" colwidth="2*"/>
       <thead>
        <row>
         <entry>Recording Control File Property</entry>
         <entry>Value</entry>
         <entry>Effect</entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry>
          <literal>issueID</literal>, <literal>referenceID</literal>
         </entry>
         <entry>
          <literal>103572</literal>, <literal>policyEvalFails</literal>

         </entry>
         <entry>
          Recording output is stored at the path
          <filename><replaceable>debugFileLocation</replaceable>/record/103572/policyEvalFails_<replaceable>timestamp</replaceable>.zip</filename>.
          For more information about the location of recording output, see
          <xref linkend="recording-location" />.
         </entry>
        </row>
        <row>
         <entry>
          <literal>Description</literal>
         </entry>
         <entry>
          <literal>Troubleshooting artifacts in support of case 103572</literal>
         </entry>
         <entry>
          No effect.
         </entry>
        </row>
        <row>
         <entry>
          <literal>zipEnable</literal>
         </entry>
         <entry>
          <literal>true</literal>
         </entry>
         <entry>
          Recording output is compressed into a zip file.
         </entry>
        </row>
        <row>
         <entry>
          <literal>configExport</literal> / <literal>enable</literal>
         </entry>
         <entry>
          <literal>true</literal>
         </entry>
         <entry>
          The OpenAM configuration is exported at the start of the recording
          event.
         </entry>
        </row>
        <row>
         <entry>
          <literal>configExport</literal> / <literal>password</literal>
         </entry>
         <entry>
          <literal>5x2RR70</literal>
         </entry>
         <entry>
          Knowledge of this password will be required to access the OpenAM
          configuration that was saved during recording.
         </entry>
        </row>
        <row>
         <entry>
          <literal>configExport</literal> / <literal>sharePassword</literal>
         </entry>
         <entry>
          <literal>false</literal>
         </entry>
         <entry>
          The password is not displayed in output messages displayed during
          the recording event or in the <filename>info.json</filename> file.
         </entry>
        </row>
        <row>
         <entry>
          <literal>debugLogs</literal> / <literal>debugLevel</literal>
         </entry>
         <entry>
          <literal>MESSAGE</literal>
         </entry>
         <entry>
          Recording enables message-level debug logs during the recording
          event.
         </entry>
        </row>
        <row>
         <entry>
          <literal>debugLogs</literal> / <literal>autoStop</literal> / <literal>time</literal>
         </entry>
         <entry>
          <literal>SECONDS</literal>, <literal>15</literal>
         </entry>
         <entry>
          Because both the <literal>time</literal> and
          <literal>fileSize</literal> properties are set, recording stops after
          15 seconds, or after the size of the debug logs exceeds 1 GB,
          whichever occurs first.
         </entry>
        </row>
        <row>
         <entry>
          <literal>debugLogs</literal> / <literal>autoStop</literal> / <literal>fileSize</literal>
         </entry>
         <entry>
          <literal>GB</literal>, <literal>1</literal>
         </entry>
         <entry>
          Because both the <literal>time</literal> and
          <literal>fileSize</literal> properties are set, recording stops after
          15 seconds, or after the size of the debug logs exceeds 1 GB,
          whichever occurs first.
         </entry>
        </row>
        <row>
         <entry>
          <literal>threadDump</literal> / <literal>enable</literal>
         </entry>
         <entry>
          <literal>true</literal>
         </entry>
         <entry>
          Thread dumps are taken throughout the recording event.
         </entry>
        </row>
        <row>
         <entry>
          <literal>threadDump</literal> / <literal>delay</literal>
         </entry>
         <entry>
          <literal>SECONDS</literal>, <literal>5</literal>
         </entry>
         <entry>
          The first thread dump is taken when the recording event starts.
          Additional thread dumps are taken every five seconds hence.
         </entry>
        </row>
       </tbody>
      </tgroup>
     </table>
    </para>
   </section>

  </section>

  <section xml:id="recording-location">
   <title>Retrieving Recording Information</title>

   <para>
    Information recorded by OpenAM is stored at the path
    <filename><replaceable>debugFileLocation</replaceable>/record/<replaceable>issueID</replaceable>/<replaceable>referenceID</replaceable></filename>.
    For example, if the debug file location is
    <filename>/home/openam/debug</filename>, the issue ID
    <literal>103572</literal>, and the reference ID
    <literal>policyEvalFails</literal>, the path containing
    recorded information is
    <filename>/home/openam/debug/record/103572/policyEvalFails</filename>.
   </para>
   <para>
    When there are multiple recording events with the same
    <literal>issueID</literal> and <literal>referenceID</literal>,
    OpenAM appends a timestamp to the <literal>referenceID</literal>
    of the earliest paths. For example, multiple recording events for
    issue ID <literal>103572</literal> and reference ID
    <literal>policyEvalFails</literal> might be stored at the
    following paths:
    <itemizedlist>
     <listitem>
      <para>
       Most recent recording: <filename><replaceable>debugFileLocation</replaceable>/record/103572/policyEvalFails</filename>
      </para>
     </listitem>
     <listitem>
      <para>
       Next most recent recording: <filename><replaceable>debugFileLocation</replaceable>/record/103572/policyEvalFails_2015-10-24-11-48-51-902-PDT</filename>
      </para>
     </listitem>
     <listitem>
      <para>
       Earliest recording: <filename><replaceable>debugFileLocation</replaceable>/record/103572/policyEvalFails_2015-08-10-15-15-10-140-PDT</filename>
      </para>
     </listitem>
    </itemizedlist>
   </para>

   <para>
    OpenAM compresses the output from recording events when you set the
    <literal>zipEnable</literal> property to <literal>true</literal>. The output
    file can be found at the path
    <filename><replaceable>debugFileLocation</replaceable>/record/<replaceable>issueID</replaceable>/<replaceable>referenceID_timestamp</replaceable>.zip</filename>.
    For example, compressed output for a recording event for
    issue ID <literal>103572</literal> and reference ID
    <literal>policyEvalFails</literal> might be stored at the
    following path:
    <filename><replaceable>debugFileLocation</replaceable>/record/103572/policyEvalFails_2015-08-12-12-19-02-683-PDT.zip</filename>.
   </para>

   <para>
    Use the <literal>referenceID</literal> property value to segregate
    output from multiple problem recreations associated with the same case.
    For example, while troubleshooting case 103572, you notice that you only
    have a problem when evaluating policy for members of the Finance realm.
    You could trigger two recording events as follows:
    <table xml:id="recording-output-location">
     <title>Segregating Recording Output Using the <literal>referenceID</literal> Value</title>
     <tgroup cols="3">
      <colspec colnum="1" colwidth="1*"/>
      <colspec colnum="2" colwidth="1*"/>
      <colspec colnum="3" colwidth="1*"/>
      <thead>
       <row>
        <entry>OpenAM Behavior</entry>
        <entry><literal>referenceID</literal>Value</entry>
        <entry>Recording Output Path</entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>
         Policy evaluation behaves as expected for members of the Engineering
         realm.
        </entry>
        <entry>
         <literal>policyEvalSucceeds</literal>
         </entry>
        <entry>
         <filename><replaceable>debugFileLocation</replaceable>/record/103572/policyEvalSucceeds</filename>
        </entry>
       </row>
       <row>
         <entry>
          Policy evaluation unexpectedly fails for members of the Finance
          realm.
         </entry>
         <entry>
          <literal>policyEvalFails</literal>
          </entry>
         <entry>
          <filename><replaceable>debugFileLocation</replaceable>/record/103572/policyEvalFails</filename>
         </entry>
        </row>
      </tbody>
     </tgroup>
    </table>
   </para>
  </section>

 </section>

 <section xml:id="session-mgmt">
  <title>Session Management</title>
  <indexterm><primary>Sessions</primary></indexterm>
  
  <para>The OpenAM console lets the administrator view and manage active
  user sessions on the Sessions tab page.</para>
  <para>Session management from the OpenAM console is only available for
  stateful sessions. Stateless sessions do not appear in the Sessions tab page.
  </para>

  <figure xml:id="figure-session-management">
   <title>Session Management Tab Page</title>
   <mediaobject>
    <alt>Session management tab page</alt>
    <imageobject>
     <imagedata fileref="images/session-management.png" format="PNG" />
    </imageobject>
    <textobject><para>The OpenAM Administrator can view stateful end user
    sessions.</para></textobject>
   </mediaobject>
  </figure>
  
  <para>To end a user session manually, select the user's session, and then
  click the Invalidate Session button. As a result, the user has to
  authenticate again.</para>
  
  <note>
      <para>Deleting a user does not automatically remove any of the user's sessions.
      After deleting a user, check for any sessions for the user and remove them under the Console's Sessions tab.
      </para>
  </note>
 </section>
</chapter>
